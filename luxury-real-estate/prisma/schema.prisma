// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String?  // null for OAuth users
  firstName String
  lastName  String
  agencyName String?
  phone     String?
  avatar    String?
  
  // OAuth fields
  googleId  String?  @unique
  appleId   String?  @unique
  
  // User preferences
  emailVerified    Boolean @default(false)
  marketingEmails  Boolean @default(true)
  propertyAlerts   Boolean @default(true)
  
  // Relationships
  favoriteProperties Property[]      @relation("UserFavorites")
  savedSearches      SavedSearch[]
  propertyViews      PropertyView[]
  contactForms       ContactForm[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("users")
}

model Property {
  id          String  @id @default(cuid())
  title       String
  description String?
  price       Int
  currency    String  @default("USD")
  
  // Location
  address     String
  city        String
  state       String
  country     String
  zipCode     String?
  latitude    Float?
  longitude   Float?
  
  // Property details
  propertyType  String  // house, apartment, condo, etc.
  listingType   String  // sale, rent
  bedrooms      Int
  bathrooms     Float
  area          Int
  areaUnit      String  @default("sqft")
  yearBuilt     Int?
  
  // Features
  features      String[] // Pool, Garden, Garage, etc.
  amenities     String[] // Gym, Concierge, etc.
  
  // Property status
  status        String  @default("active") // active, sold, pending, off-market
  featured      Boolean @default(false)
  
  // Media
  images        PropertyImage[]
  
  // Relationships
  favoritedBy   User[]         @relation("UserFavorites")
  views         PropertyView[]
  contactForms  ContactForm[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("properties")
}

model PropertyImage {
  id         String  @id @default(cuid())
  url        String
  alt        String?
  isMainImage Boolean @default(false)
  order      Int     @default(0)
  
  // Relationship
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  propertyId String
  
  createdAt DateTime @default(now())
  
  @@map("property_images")
}

model SavedSearch {
  id          String @id @default(cuid())
  name        String
  searchQuery Json   // Store search filters as JSON
  alertsEnabled Boolean @default(true)
  
  // Relationship
  user        User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      String
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("saved_searches")
}

model PropertyView {
  id String @id @default(cuid())
  
  // Relationships
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId     String
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  propertyId String
  
  viewedAt DateTime @default(now())
  
  @@unique([userId, propertyId])
  @@map("property_views")
}

model ContactForm {
  id      String @id @default(cuid())
  name    String
  email   String
  phone   String?
  message String
  
  // Form context
  formType    String // "property_inquiry", "general", "viewing_request"
  
  // Relationships
  user        User?     @relation(fields: [userId], references: [id])
  userId      String?
  property    Property? @relation(fields: [propertyId], references: [id])
  propertyId  String?
  
  createdAt DateTime @default(now())
  
  @@map("contact_forms")
}

model PasswordReset {
  id        String   @id @default(cuid())
  email     String
  token     String   @unique
  expiresAt DateTime
  used      Boolean  @default(false)
  
  createdAt DateTime @default(now())
  
  @@map("password_resets")
}

model EmailVerification {
  id        String   @id @default(cuid())
  email     String
  token     String   @unique
  expiresAt DateTime
  verified  Boolean  @default(false)
  
  createdAt DateTime @default(now())
  
  @@map("email_verifications")
}